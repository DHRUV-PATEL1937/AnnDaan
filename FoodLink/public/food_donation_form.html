<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AnnDan - Share the Joy of Food</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

        <!-- Firebase SDKs -->
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

        <style>
            /* --- Global Styles & Variables --- */
            :root {
                --brand: #5D87FF;
                --dark-blue: #2A3547;
                --text: #2A3547;
                --muted: #7C8FAC;
                --border: #e5eaef;
                --light-bg: #f6f9fc;
                --white: #ffffff;
                --grad: linear-gradient(135deg, #6B8DFF 0%, #5D87FF 100%);
                --ease-out-quint: cubic-bezier(0.22, 1, 0.36, 1);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Inter', sans-serif;
                background-color: var(--light-bg);
                color: var(--text);
                line-height: 1.6;
                position: relative;
                min-height: 100vh;
                overflow-x: hidden;
                width: 100%;
            }

            html {
                scroll-behavior: smooth;
                overflow-x: hidden;
            }

            /* --- TOP 1% UPGRADE: ENHANCED BUTTON --- */
            .btn {
                background: var(--grad);
                color: white;
                border: none;
                border-radius: 8px;
                padding: 12px 24px;
                font-weight: 600;
                font-size: 14px;
                cursor: pointer;
                transition: all 0.3s var(--ease-out-quint);
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                box-shadow: 0 4px 15px rgba(93, 135, 255, 0.2);
            }

            .btn:hover {
                transform: translateY(-4px);
                box-shadow: 0 10px 25px rgba(93, 135, 255, 0.35);
            }

            .btn:active {
                transform: translateY(-1px);
                box-shadow: 0 4px 15px rgba(93, 135, 255, 0.2);
            }

            /* --- TOP 1% UPGRADE: DYNAMIC BACKGROUND SHAPES --- */
            .shape {
                position: absolute;
                z-index: -1;
                opacity: 0.3;
                transition: transform 1s var(--ease-out-quint);
            }

            .shape-1 {
                top: 10%;
                left: 5%;
                width: 300px;
                height: 300px;
                border-radius: 50%;
                background: linear-gradient(45deg, #5D87FF, #6E94FF);
                filter: blur(100px);
                animation: float 12s ease-in-out infinite;
            }

            .shape-2 {
                bottom: 10%;
                right: 5%;
                width: 250px;
                height: 250px;
                border-radius: 50%;
                background: linear-gradient(45deg, #5D87FF, #8CAAFF);
                filter: blur(80px);
                animation: float 15s ease-in-out infinite reverse;
            }

            @keyframes float {
                0% {
                    transform: translate(0, 0) scale(1);
                }

                50% {
                    transform: translate(30px, -40px) scale(1.1);
                }

                100% {
                    transform: translate(0, 0) scale(1);
                }
            }

            .container {
                width: 90%;
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 15px;
            }

            .site-header {
                background-color: rgba(255, 255, 255, 0.8);
                backdrop-filter: blur(10px);
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                padding: 1rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }

            .main-nav {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .logo {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--brand);
                text-decoration: none;
            }

            .nav-links {
                list-style: none;
                margin: 0;
                padding: 0;
                display: flex;
                gap: 2rem;
            }

            .nav-links a {
                text-decoration: none;
                color: var(--text);
                font-weight: 500;
                transition: all 0.3s ease;
                position: relative;
                padding-bottom: 5px;
            }

            .nav-links a:hover {
                color: var(--brand);
            }

            .nav-links a::after {
                content: '';
                position: absolute;
                width: 0;
                height: 2px;
                bottom: 0;
                left: 0;
                background-color: var(--brand);
                transition: width 0.3s ease;
            }

            .nav-links a:hover::after {
                width: 100%;
            }

            /* --- TOP 1% UPGRADE: HERO SECTION STYLING & ANIMATION --- */
            .hero {
                background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://placehold.co/1200x600/5D87FF/ffffff?text=Help+Feed+Someone') no-repeat center center/cover;
                color: var(--white);
                text-align: center;
                padding: 9rem 0;
                border-radius: 0 0 30px 30px;
                margin-bottom: 4rem;
                overflow: hidden;
            }

            .hero-content h1 {
                font-size: clamp(2.5rem, 6vw, 4rem);
                margin-bottom: 1.5rem;
                line-height: 1.2;
                font-weight: 700;
            }

            .hero-content h1 .word {
                display: inline-block;
                opacity: 0;
                transform: translateY(30px);
                animation: reveal-word 0.8s var(--ease-out-quint) forwards;
            }

            @keyframes reveal-word {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .hero-content .subtitle {
                font-size: 1.2rem;
                max-width: 700px;
                margin: 0 auto 2.5rem;
                color: rgba(255, 255, 255, 0.9);
                line-height: 1.8;
                opacity: 0;
                transform: translateY(20px);
                animation: reveal-subtitle 1s var(--ease-out-quint) 0.5s forwards;
            }

            @keyframes reveal-subtitle {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .how-it-works,
            .donation-section {
                padding: 4rem 0;
            }

            .how-it-works {
                background-color: var(--white);
                text-align: center;
                border-radius: 20px;
                margin-bottom: 4rem;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            }

            .how-it-works h2 {
                font-size: 2.5rem;
                margin-bottom: 3rem;
                color: var(--text);
                position: relative;
                display: inline-block;
            }

            .how-it-works h2::after {
                content: '';
                position: absolute;
                width: 60px;
                height: 4px;
                background: var(--brand);
                bottom: -10px;
                left: 50%;
                transform: translateX(-50%);
                border-radius: 2px;
            }

            .steps-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 2rem;
                margin-top: 3rem;
            }

            /* --- TOP 1% UPGRADE: INTERACTIVE STEP CARDS --- */
            .step-card {
                padding: 2.5rem 2rem;
                border-radius: 16px;
                background-color: var(--light-bg);
                transition: all 0.4s var(--ease-out-quint);
                border: 1px solid var(--border);
                transform-style: preserve-3d;
            }

            .step-card:hover {
                transform: translateY(-12px) perspective(1000px) rotateX(2deg) rotateY(-4deg);
                box-shadow: 0 15px 40px rgba(93, 135, 255, 0.15);
                border-color: var(--brand);
            }

            .step-icon {
                font-size: 3.5rem;
                margin-bottom: 1.5rem;
                display: inline-block;
                transition: transform 0.4s var(--ease-out-quint);
            }

            .step-card:hover .step-icon {
                transform: scale(1.1) rotate(-5deg);
            }

            .step-card h3 {
                font-size: 1.25rem;
                margin-bottom: 1rem;
                color: var(--text);
                font-weight: 600;
            }

            .step-card p {
                color: var(--muted);
                line-height: 1.7;
            }

            .form-container {
                background-color: var(--white);
                padding: 2.5rem;
                border-radius: 16px;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
                width: 100%;
                max-width: 48rem;
                margin: 0 auto;
                border: 1px solid var(--border);
                transition: opacity 0.5s ease, transform 0.5s ease;
            }

            .form-container.fading-out {
                opacity: 0;
                transform: scale(0.95);
            }

            .form-header {
                text-align: center;
                margin-bottom: 2.5rem;
            }

            .form-header h2 {
                font-size: 2rem;
                color: var(--text);
                margin-bottom: 0.5rem;
            }

            .form-header p {
                color: var(--muted);
            }

            fieldset {
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }

            legend {
                font-size: 1.125rem;
                font-weight: 600;
                padding: 0 0.75rem;
                color: var(--text);
            }

            .grid-container {
                display: grid;
                grid-template-columns: 1fr;
                gap: 2.5rem 1.5rem;
            }

            @media (min-width: 768px) {
                .grid-container {
                    grid-template-columns: 1fr 1fr;
                }

                .full-width {
                    grid-column: 1 / -1;
                }
            }

            /* --- TOP 1% UPGRADE: FLOATING LABEL FORM INPUTS --- */
            .input-group {
                position: relative;
            }

            .input-group input,
            .input-group textarea {
                width: 100%;
                padding: 1rem;
                border: 1px solid var(--border);
                border-radius: 8px;
                font-size: 1rem;
                font-family: 'Inter', sans-serif;
                color: var(--text);
                background-color: var(--white);
                transition: all 0.3s ease;
            }

            .input-group textarea {
                resize: vertical;
            }

            .input-group label {
                position: absolute;
                left: 1rem;
                top: 50%;
                transform: translateY(-50%);
                color: var(--muted);
                background-color: var(--white);
                padding: 0 0.25rem;
                transition: all 0.2s ease;
                pointer-events: none;
                font-size: 1rem;
            }

            .input-group input:focus,
            .input-group textarea:focus,
            .input-group input:not(:placeholder-shown),
            .input-group textarea:not(:placeholder-shown) {
                outline: none;
                border-color: var(--brand);
                box-shadow: 0 0 0 3px rgba(93, 135, 255, 0.1);
            }

            .input-group input:focus+label,
            .input-group textarea:focus+label,
            .input-group input:not(:placeholder-shown)+label,
            .input-group textarea:not(:placeholder-shown)+label {
                top: 0;
                font-size: 0.75rem;
                color: var(--brand);
                font-weight: 500;
            }

            /* End Floating Label Styles */

            .radio-group {
                display: flex;
                align-items: center;
                gap: 1.5rem;
                padding-top: 0.25rem;
            }

            .radio-group input[type="radio"],
            .checkbox-group input[type="checkbox"] {
                width: auto;
                margin-right: 0.35rem;
                accent-color: var(--brand);
            }

            .checkbox-group {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .radio-group>label,
            .checkbox-group>label {
                margin-bottom: 0;
                font-weight: 400;
                color: var(--text);
                cursor: pointer;
                display: flex;
                align-items: center;
            }

            input[type="file"] {
                padding: 0.5rem;
                background-color: var(--light-bg);
                border-radius: 8px;
                border: 1px solid var(--border);
                width: 100%;
            }

            input[type="file"]::file-selector-button {
                background: var(--grad);
                color: white;
                border: none;
                border-radius: 6px;
                padding: 8px 16px;
                font-weight: 500;
                font-family: 'Inter', sans-serif;
                cursor: pointer;
                transition: all 0.2s ease;
                margin-right: 1rem;
            }

            input[type="file"]::file-selector-button:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 10px rgba(93, 135, 255, 0.2);
            }

            .hidden {
                display: none;
            }

            .loader-container,
            .confirmation-message {
                text-align: center;
                padding: 2rem;
            }

            .loader {
                border: 4px solid var(--border);
                border-radius: 50%;
                border-top: 4px solid var(--brand);
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin: 0 auto;
            }

            /* --- TOP 1% UPGRADE: ANIMATED CONFIRMATION MESSAGE --- */
            .confirmation-message .reveal-item {
                opacity: 0;
                transform: translateY(20px);
                animation: reveal-item 0.6s var(--ease-out-quint) forwards;
            }

            @keyframes reveal-item {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .success-icon {
                margin: 0 auto;
                background-color: var(--brand);
                border-radius: 50%;
                height: 5rem;
                width: 5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 10px 20px rgba(93, 135, 255, 0.3);
                transform: scale(0.5);
            }

            .success-icon svg {
                height: 3rem;
                width: 3rem;
                color: white;
            }

            .confirmation-message h2 {
                font-size: 1.875rem;
                margin-top: 1.5rem;
                color: var(--text);
            }

            .confirmation-message .subtitle {
                margin-top: 0.5rem;
                margin-bottom: 1.5rem;
                color: var(--muted);
            }

            .ai-summary {
                text-align: left;
                background-color: var(--light-bg);
                padding: 1.5rem;
                border-radius: 12px;
                border: 1px solid var(--border);
                margin-top: 2rem;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
            }

            .ai-summary h3 {
                font-weight: 600;
                margin-bottom: 1rem;
                color: var(--text);
                font-size: 1.125rem;
            }

            .summary-content {
                white-space: pre-wrap;
                font-size: 0.9rem;
                line-height: 1.7;
                color: var(--muted);
            }

            .site-footer {
                background-color: var(--dark-blue);
                color: rgba(255, 255, 255, 0.8);
                text-align: center;
                padding: 2rem 0;
                margin-top: 6rem;
                border-radius: 20px 20px 0 0;
            }

            /* --- TOP 1% UPGRADE: ON-SCROLL REVEAL ANIMATIONS --- */
            .reveal-on-scroll {
                opacity: 0;
                transform: translateY(40px);
                transition: opacity 0.8s var(--ease-out-quint), transform 0.8s var(--ease-out-quint);
            }

            .reveal-on-scroll.revealed {
                opacity: 1;
                transform: translateY(0);
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }

                to {
                    opacity: 1;
                }
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }

            @media (max-width: 768px) {
                .main-nav {
                    flex-direction: column;
                    gap: 1rem;
                }

                .nav-links {
                    flex-wrap: wrap;
                    justify-content: center;
                    gap: 1rem;
                }

                .hero {
                    padding: 6rem 0;
                }

                .hero-content h1 {
                    font-size: 2.5rem;
                }

                .hero-content .subtitle {
                    font-size: 1rem;
                }

                .form-container {
                    padding: 1.5rem;
                }

                fieldset {
                    padding: 1rem;
                }
            }
        </style>
    </head>

    <body>
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>

        <header class="site-header">
            <div class="container">
                <nav class="main-nav">
                    <a href="#" class="logo">FoodLink</a>
                    <ul class="nav-links">
                        <li><a href="#">Home</a></li>
                        <li><a href="#how-it-works">How It Works</a></li>
                        <li><a href="#donate-form">Donate Now</a></li>
                        <li><a href="index.html">Rider Dashboard</a></li>
                        <li id="auth-links"><a href="#" class="login-link">Login</a></li>
                        <li id="welcome-message" style="display: none;">Welcome, <span id="user-name"></span>! (<a
                                href="#" id="logout-link">Logout</a>)</li>
                    </ul>
                </nav>
            </div>
        </header>

        <main>
            <section class="hero">
                <div class="container">
                    <div class="hero-content">
                        <h1 id="hero-title">Turn Your Leftovers into a Lifeline.</h1>
                        <p class="subtitle">Join our community in fighting food waste and hunger. Your extra food can be
                            a meal for someone in need.</p>
                        <a href="#donate-form" class="btn reveal-on-scroll">Donate Food Now</a>
                    </div>
                </div>
            </section>

            <section id="how-it-works" class="how-it-works">
                <div class="container">
                    <h2 class="reveal-on-scroll">How It Works in 3 Easy Steps</h2>
                    <div class="steps-container">
                        <div class="step-card reveal-on-scroll" style="transition-delay: 0.1s;">
                            <div class="step-icon">üìù</div>
                            <h3>1. Fill the Form</h3>
                            <p>Provide details about the food, your location, and a convenient pickup time.</p>
                        </div>
                        <div class="step-card reveal-on-scroll" style="transition-delay: 0.2s;">
                            <div class="step-icon">üõµ</div>
                            <h3>2. We Collect</h3>
                            <p>A volunteer will be assigned to pick up the donation right from your doorstep.</p>
                        </div>
                        <div class="step-card reveal-on-scroll" style="transition-delay: 0.3s;">
                            <div class="step-icon">‚ù§Ô∏è</div>
                            <h3>3. We Distribute</h3>
                            <p>Your food is delivered to local shelters and communities, reaching those who need it
                                most.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="donate-form" class="donation-section">
                <div id="formContainer" class="form-container reveal-on-scroll">
                    <div id="formHeader" class="form-header">
                        <h2>Share Your Leftover Food üçΩÔ∏è</h2>
                        <p>Fill out the details below to help someone in need.</p>
                    </div>

                    <form id="foodDonationForm">
                        <fieldset>
                            <legend>Your Information</legend>
                            <div class="grid-container">
                                <div class="input-group">
                                    <input type="text" id="donorName" name="donorName" placeholder=" " required>
                                    <label for="donorName">Name</label>
                                </div>
                                <div class="input-group">
                                    <input type="tel" id="contactNumber" name="contactNumber" placeholder=" " required>
                                    <label for="contactNumber">Contact Number</label>
                                </div>
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend>Pickup Details</legend>
                            <div class="grid-container">
                                <div class="input-group full-width">
                                    <textarea id="address" name="address" rows="3" placeholder=" " required></textarea>
                                    <label for="address">Full Address (e.g., B-402, Samarpan Heights...)</label>
                                </div>
                                <div class="input-group">
                                    <input type="datetime-local" id="pickupTime" name="pickupTime" placeholder=" "
                                        required>
                                    <label for="pickupTime">Preferred Pickup Time</label>
                                </div>
                                <div class="input-group">
                                    <input type="datetime-local" id="cookedTime" name="cookedTime" placeholder=" "
                                        required>
                                    <label for="cookedTime">When was it prepared?</label>
                                </div>
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend>Food Details</legend>
                            <div class="grid-container">
                                <div class="full-width">
                                    <label style="font-weight: 500; color: var(--text); margin-bottom: 0.75rem;">Food
                                        Category</label>
                                    <div class="radio-group">
                                        <label for="veg">
                                            <input type="radio" id="veg" name="foodCategory" value="Veg" checked
                                                required> Vegetarian
                                        </label>
                                        <label for="nonveg">
                                            <input type="radio" id="nonveg" name="foodCategory" value="Non-Veg">
                                            Non-Vegetarian
                                        </label>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <input type="text" id="foodType" name="foodType" placeholder=" " required>
                                    <label for="foodType">Type of Food (e.g., Rice, Dal)</label>
                                </div>
                                <div class="input-group">
                                    <input type="number" id="quantity" name="quantity" min="1" placeholder=" " required>
                                    <label for="quantity">Quantity (serves # people)</label>
                                </div>
                                <div class="input-group full-width">
                                    <input type="number" id="shelfLife" name="shelfLife" min="1" placeholder=" "
                                        required>
                                    <label for="shelfLife">Shelf Life (in hours)</label>
                                </div>
                                <div class="full-width">
                                    <label style="font-weight: 500; color: var(--text);">Upload a Photo
                                        (Optional)</label>
                                    <input type="file" id="foodImage" name="foodImage" accept="image/*">
                                </div>
                                <div class="input-group full-width">
                                    <textarea id="notes" name="notes" rows="2" placeholder=" "></textarea>
                                    <label for="notes">Special Instructions (e.g., Contains nuts)</label>
                                </div>
                                <div class="full-width checkbox-group">
                                    <input type="checkbox" id="ngoReview" name="ngoReview">
                                    <label for="ngoReview" style="font-weight: 500;">This is a large donation (requires
                                        NGO review)</label>
                                </div>
                            </div>
                        </fieldset>
                        <button type="submit" class="btn">List My Food Donation</button>
                    </form>

                    <div id="loaderContainer" class="hidden loader-container">
                        <div class="loader"></div>
                        <p>Finding location and processing your donation...</p>
                    </div>

                    <div id="confirmationMessage" class="hidden confirmation-message">
                        <div class="success-icon reveal-item">
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                        <h2 class="reveal-item" style="animation-delay: 0.2s;">Thank You!</h2>
                        <p class="subtitle reveal-item" style="animation-delay: 0.4s;">Your donation has been listed!
                        </p>
                        <div id="aiSummary" class="ai-summary reveal-item" style="animation-delay: 0.6s;">
                            <h3>Your Donation Summary:</h3>
                            <div id="summaryContent" class="summary-content"></div>
                        </div>
                        <button id="newDonationBtn" class="btn reveal-item"
                            style="animation-delay: 0.8s; margin-top: 1rem;">Make Another Donation</button>
                    </div>
                </div>
            </section>
        </main>

        <footer class="site-footer">
            <div class="container">
                <p>&copy; 2025 AnnDan. All Rights Reserved.</p>
            </div>
        </footer>

        <script>
            document.addEventListener('DOMContentLoaded', function () {

                // --- YOUR FIREBASE CONFIGURATION ---
                const firebaseConfig = {
                    apiKey: "AIzaSyBDmqExQUrb5biHxu9ZZxZBaTZq6cK2mH4",
                    authDomain: "foodlink-be309.firebaseapp.com",
                    projectId: "foodlink-be309",
                    storageBucket: "foodlink-be309.appspot.com",
                    messagingSenderId: "362981391704",
                    appId: "1:362981391704:web:86434e32f4a77c8234f92d",
                    measurementId: "G-ZBPP67701F"
                };

                // --- INITIALIZE FIREBASE AND FIRESTORE ---
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                const db = firebase.firestore();

                // --- Element Selections ---
                const formContainer = document.getElementById('formContainer');
                const form = document.getElementById('foodDonationForm');
                const formHeader = document.getElementById('formHeader');
                const confirmationMessage = document.getElementById('confirmationMessage');
                const loaderContainer = document.getElementById('loaderContainer');
                const summaryContent = document.getElementById('summaryContent');
                const newDonationBtn = document.getElementById('newDonationBtn');
                const donorNameInput = document.getElementById('donorName');

                // --- Geocoding service to convert addresses to coordinates ---
                class GeocodingService {
                    static async geocodeAddress(address) {
                        try {
                            const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address + ', Vadodara, Gujarat, India')}&limit=1`);
                            const data = await response.json();

                            if (data && data.length > 0) {
                                return {
                                    lat: parseFloat(data[0].lat),
                                    lng: parseFloat(data[0].lon),
                                };
                            }
                        } catch (error) {
                            console.warn('Geocoding failed, using fallback:', error);
                        }

                        // Fallback to a random Vadodara area coordinate
                        return {
                            lat: 22.3072 + (Math.random() - 0.5) * 0.05,
                            lng: 73.1812 + (Math.random() - 0.5) * 0.05,
                        };
                    }
                }

                // --- Form Submission Logic ---
                form.addEventListener('submit', async function (event) {
                    event.preventDefault();

                    form.parentElement.classList.add('fading-out');
                    formHeader.classList.add('fading-out');

                    setTimeout(async () => {
                        form.classList.add('hidden');
                        formHeader.classList.add('hidden');
                        loaderContainer.classList.remove('hidden');

                        const formData = new FormData(form);
                        const donationDetails = Object.fromEntries(formData.entries());
                        const isNgoManaged = donationDetails.ngoReview === 'on';

                        try {
                            const location = await GeocodingService.geocodeAddress(donationDetails.address);

                            const donationDataForDb = {
                                donorName: donationDetails.donorName,
                                contactNumber: donationDetails.contactNumber,
                                address: donationDetails.address,
                                pickupTime: new Date(donationDetails.pickupTime),
                                cookedTime: new Date(donationDetails.cookedTime),
                                foodCategory: donationDetails.foodCategory,
                                foodItems: donationDetails.foodType,
                                quantity: parseInt(donationDetails.quantity),
                                shelfLife: parseInt(donationDetails.shelfLife),
                                notes: donationDetails.notes,
                                location: new firebase.firestore.GeoPoint(location.lat, location.lng),
                                status: isNgoManaged ? 'pending_ngo_approval' : 'pending',
                                isNgoManaged: isNgoManaged,
                                assignedRider: null,
                                submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                            };

                            const docRef = await db.collection("donations").add(donationDataForDb);
                            console.log("Donation written with ID: ", docRef.id);

                            const summary = generateDonationSummary(donationDataForDb, docRef.id);
                            summaryContent.textContent = summary;

                            showConfirmation();
                        } catch (error) {
                            console.error("Error adding donation to Firebase:", error);
                            form.parentElement.classList.remove('fading-out');
                            formHeader.classList.remove('fading-out');
                            form.classList.remove('hidden');
                            formHeader.classList.remove('hidden');
                            alert(`An error occurred: ${error.message}`);
                        } finally {
                            loaderContainer.classList.add('hidden');
                        }
                    }, 500);
                });

                function showConfirmation() {
                    confirmationMessage.classList.remove('hidden');
                }

                function resetForm() {
                    form.reset();
                    confirmationMessage.classList.add('hidden');
                    form.classList.remove('hidden');
                    formHeader.classList.remove('hidden');
                    formContainer.classList.remove('fading-out');
                    initializeDateTimeInputs();
                }

                newDonationBtn.addEventListener('click', resetForm);

                function generateDonationSummary(donation, docId) {
                    const pickupDate = donation.pickupTime.toLocaleString('en-IN', {
                        dateStyle: 'medium',
                        timeStyle: 'short'
                    });

                    const statusText = donation.isNgoManaged ? 'Waiting for NGO approval...' : 'Notifying nearby riders...';

                    return `Donation ID: #${docId.substring(0, 8)} 
                    \nFood: ${donation.foodCategory} ${donation.foodItems} (for ${donation.quantity})
                    \nPickup Address: ${donation.address}
                    \nPreferred Pickup: ${pickupDate}
                    \nStatus: ${statusText}`;
                }

                // --- UI Initializations ---
                function initializeDateTimeInputs() {
                    const pickupTimeInput = document.getElementById('pickupTime');
                    const cookedTimeInput = document.getElementById('cookedTime');
                    if (pickupTimeInput && cookedTimeInput) {
                        const now = new Date();
                        const defaultPickupTime = new Date();
                        defaultPickupTime.setHours(defaultPickupTime.getHours() + 1);
                        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                        defaultPickupTime.setMinutes(defaultPickupTime.getMinutes() - defaultPickupTime.getTimezoneOffset());

                        const minTime = now.toISOString().slice(0, 16);
                        const defaultPickupValue = defaultPickupTime.toISOString().slice(0, 16);

                        pickupTimeInput.min = minTime;
                        cookedTimeInput.max = minTime;
                        pickupTimeInput.value = defaultPickupValue;
                        cookedTimeInput.value = minTime;
                    }
                }

                // --- TOP 1% UPGRADE: HERO TEXT & SCROLL ANIMATIONS ---
                const heroTitle = document.getElementById('hero-title');
                if (heroTitle) {
                    const words = heroTitle.innerText.split(' ');
                    heroTitle.innerHTML = words.map((word, index) => `<span class="word" style="animation-delay: ${index * 0.1}s">${word}</span>`).join(' ');
                }
                const revealElements = document.querySelectorAll('.reveal-on-scroll');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('revealed');
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.1 });
                revealElements.forEach(el => observer.observe(el));

                initializeDateTimeInputs();
            });
        </script>
    </body>

</html>